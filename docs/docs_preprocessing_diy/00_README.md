# DIY Dataset Preprocessing Documentation

## ğŸ“š Complete Documentation Index

This documentation provides comprehensive coverage of the DIY (Do-It-Yourself) dataset preprocessing pipeline for next location prediction research. The documentation is structured to guide you from high-level concepts to detailed code-level explanations.

---

## ğŸ“– Documentation Structure

### Overview Documents
| Document | Description |
|----------|-------------|
| [01_Pipeline_Overview.md](./01_Pipeline_Overview.md) | High-level architecture and data flow overview |
| [02_Data_Structures.md](./02_Data_Structures.md) | Complete data structure definitions and examples |
| [03_Configuration_Guide.md](./03_Configuration_Guide.md) | Configuration parameters and their meanings |

### Script Documentation
| Document | Script | Description |
|----------|--------|-------------|
| [04_PSL_Detection_Notebook.md](./04_PSL_Detection_Notebook.md) | `02_psl_detection_all.ipynb` | Position â†’ Staypoint â†’ Location detection |
| [05_Raw_to_Interim_DBSCAN.md](./05_Raw_to_Interim_DBSCAN.md) | `diy_1_raw_to_interim.py` | Raw data to interim (DBSCAN clustering) |
| [06_Interim_to_Processed.md](./06_Interim_to_Processed.md) | `diy_2_interim_to_processed.py` | Interim to processed sequences |
| [07_Raw_to_Interim_H3.md](./07_Raw_to_Interim_H3.md) | `diy_h3_1_raw_to_interim.py` | Raw data to interim (H3 grid) |
| [08_Interim_to_Processed_H3.md](./08_Interim_to_Processed_H3.md) | `diy_h3_2_interim_to_processed.py` | H3 interim to processed sequences |

### Deep Dive Documents
| Document | Description |
|----------|-------------|
| [09_Location_Clustering.md](./09_Location_Clustering.md) | DBSCAN vs H3 location clustering comparison |
| [10_Temporal_Features.md](./10_Temporal_Features.md) | Temporal feature extraction details |
| [11_Sequence_Generation.md](./11_Sequence_Generation.md) | Sequence generation algorithm |
| [12_Quality_Filtering.md](./12_Quality_Filtering.md) | User quality filtering methodology |
| [13_Data_Splitting.md](./13_Data_Splitting.md) | Train/Val/Test splitting strategy |

---

## ğŸ—ºï¸ Pipeline Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DIY DATASET PREPROCESSING PIPELINE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 0: RAW GPS DATA PROCESSING (02_psl_detection_all.ipynb)                       â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                     â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Raw GPS     â”‚â”€â”€â”€â–¶â”‚ Positionfixesâ”‚â”€â”€â”€â–¶â”‚  Staypoints  â”‚â”€â”€â”€â–¶â”‚   Triplegs   â”‚      â”‚
â”‚  â”‚  Points      â”‚    â”‚    (pfs)     â”‚    â”‚     (sp)     â”‚    â”‚    (tpls)    â”‚      â”‚
â”‚  â”‚ 165M points  â”‚    â”‚              â”‚    â”‚              â”‚    â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                   â”‚                   â”‚              â”‚
â”‚                                                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                           â–¼                          â”‚
â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                                                  â”‚    Trips     â”‚                    â”‚
â”‚                                                  â”‚              â”‚                    â”‚
â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                           â”‚                          â”‚
â”‚                                                           â–¼                          â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                          â”‚   Quality Filtering        â”‚              â”‚
â”‚                                          â”‚   â€¢ day_filter: 60 days    â”‚              â”‚
â”‚                                          â”‚   â€¢ min_thres: 0.6         â”‚              â”‚
â”‚                                          â”‚   â€¢ mean_thres: 0.7        â”‚              â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                           â”‚                          â”‚
â”‚                                                           â–¼                          â”‚
â”‚  OUTPUT FILES:                                                                       â”‚
â”‚  â”œâ”€â”€ 3_staypoints_fun_generate_trips.csv (All staypoints with is_activity flag)     â”‚
â”‚  â””â”€â”€ 10_filter_after_user_quality_DIY_slide_filteres.csv (Valid user IDs)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: RAW TO INTERIM (diy_1_raw_to_interim.py OR diy_h3_1_raw_to_interim.py)     â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                              INPUT FILES                                      â”‚  â”‚
â”‚  â”‚  data/raw_diy/3_staypoints_fun_generate_trips.csv                            â”‚  â”‚
â”‚  â”‚  data/raw_diy/10_filter_after_user_quality_DIY_slide_filteres.csv            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                          â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚           â”‚                                                              â”‚          â”‚
â”‚           â–¼                                                              â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   DBSCAN Version    â”‚                                    â”‚     H3 Version      â”‚â”‚
â”‚  â”‚   (epsilon=50m)     â”‚                                    â”‚   (resolution=8)    â”‚â”‚
â”‚  â”‚                     â”‚                                    â”‚                     â”‚â”‚
â”‚  â”‚ â€¢ Density-based     â”‚                                    â”‚ â€¢ Grid-based        â”‚â”‚
â”‚  â”‚ â€¢ Adaptive shapes   â”‚                                    â”‚ â€¢ Fixed hexagons    â”‚â”‚
â”‚  â”‚ â€¢ ~461m resolution  â”‚                                    â”‚ â€¢ ~461m edge        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚           â”‚                                                              â”‚          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                          â–¼                                          â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                           â”‚     Merge Staypoints         â”‚                          â”‚
â”‚                           â”‚   (max_time_gap: 1min)       â”‚                          â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                          â”‚                                          â”‚
â”‚                                          â–¼                                          â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                           â”‚  Enrich Temporal Features    â”‚                          â”‚
â”‚                           â”‚  â€¢ start_day, end_day        â”‚                          â”‚
â”‚                           â”‚  â€¢ start_min, end_min        â”‚                          â”‚
â”‚                           â”‚  â€¢ weekday, duration         â”‚                          â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                          â”‚                                          â”‚
â”‚                                          â–¼                                          â”‚
â”‚  OUTPUT: data/diy_eps{epsilon}/interim/intermediate_eps{epsilon}.csv               â”‚
â”‚      OR: data/diy_h3r{resolution}/interim/intermediate_h3r{resolution}.csv          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: INTERIM TO PROCESSED (diy_2_interim_to_processed.py)                       â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                              INPUT FILE                                       â”‚  â”‚
â”‚  â”‚  data/diy_eps{epsilon}/interim/intermediate_eps{epsilon}.csv                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                          â”‚
â”‚                                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ STEP 1: Split Dataset (Per User Temporal Split)                                â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚â”‚ User Timeline: Day 0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Day Max    â”‚â”‚â”‚
â”‚  â”‚â”‚                 â”‚â—„â”€â”€â”€â”€ Train (80%) â”€â”€â”€â”€â–¶â”‚â—„â”€Val(10%)â”€â–¶â”‚â—„â”€Test(10%)â”€â–¶â”‚        â”‚â”‚â”‚
â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚                                          â”‚
â”‚                                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ STEP 2: Encode Location IDs (OrdinalEncoder + offset)                          â”‚â”‚
â”‚  â”‚ â€¢ Fit on train data only                                                        â”‚â”‚
â”‚  â”‚ â€¢ Add +2 offset (0=padding, 1=unknown)                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚                                          â”‚
â”‚                                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ STEP 3: Filter Valid Sequences (previous_day window)                           â”‚â”‚
â”‚  â”‚ â€¢ Minimum history: previous_day (default: 7 days)                               â”‚â”‚
â”‚  â”‚ â€¢ Minimum sequence length: 3 staypoints                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚                                          â”‚
â”‚                                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ STEP 4: Generate Sequences (Parallel Processing)                               â”‚â”‚
â”‚  â”‚                                                                                  â”‚â”‚
â”‚  â”‚  For each valid staypoint (target):                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚  History Window (previous_day=7)          â”‚ Target  â”‚                   â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”    â”‚â”Œâ”€â”€â”€â”€â”€â”€â”â”‚                    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚ SP1â”‚ SP2â”‚ SP3â”‚ SP4â”‚ SP5â”‚ SP6â”‚ SP7â”‚â”€â”€â”€â–¶â”‚â”‚ SP8  â”‚â”‚                    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜    â”‚â””â”€â”€â”€â”€â”€â”€â”˜â”‚                    â”‚   â”‚â”‚
â”‚  â”‚  â”‚        X (features)                       â”‚   Y     â”‚                   â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚                                                                                  â”‚â”‚
â”‚  â”‚  Sequence Features:                                                              â”‚â”‚
â”‚  â”‚  â€¢ X: location_id sequence                                                       â”‚â”‚
â”‚  â”‚  â€¢ user_X: user_id (repeated)                                                    â”‚â”‚
â”‚  â”‚  â€¢ weekday_X: weekday values (0-6)                                               â”‚â”‚
â”‚  â”‚  â€¢ start_min_X: start minute of day (0-1440)                                     â”‚â”‚
â”‚  â”‚  â€¢ dur_X: duration in minutes                                                    â”‚â”‚
â”‚  â”‚  â€¢ diff: days difference to target                                               â”‚â”‚
â”‚  â”‚  â€¢ Y: target location_id                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚                                          â”‚
â”‚                                          â–¼                                          â”‚
â”‚  OUTPUT FILES:                                                                       â”‚
â”‚  â”œâ”€â”€ data/diy_eps{epsilon}/processed/diy_eps{epsilon}_prev{day}_train.pk           â”‚
â”‚  â”œâ”€â”€ data/diy_eps{epsilon}/processed/diy_eps{epsilon}_prev{day}_validation.pk      â”‚
â”‚  â”œâ”€â”€ data/diy_eps{epsilon}/processed/diy_eps{epsilon}_prev{day}_test.pk            â”‚
â”‚  â””â”€â”€ data/diy_eps{epsilon}/processed/diy_eps{epsilon}_prev{day}_metadata.json      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ Key Concepts

### 1. **Staypoint**
A staypoint represents a location where a user stayed for a significant amount of time. It is detected when GPS points cluster within a certain distance threshold for a minimum time threshold.

### 2. **Location**
A location is a semantic place derived from clustering multiple staypoints. The same physical place visited multiple times becomes one location.

### 3. **Sequence**
A sequence consists of historical staypoints (X) and a target location (Y). The model learns to predict the next location based on movement history.

### 4. **Quality Filtering**
Users are filtered based on tracking quality to ensure reliable data for model training.

---

## ğŸ› ï¸ Quick Start

### Prerequisites
```bash
pip install trackintel geopandas pandas numpy scikit-learn h3 tqdm pyyaml
```

### Running the Pipeline

#### Option A: DBSCAN-based Location Clustering
```bash
# Step 1: Raw to Interim
python preprocessing/diy_1_raw_to_interim.py --config config/preprocessing/diy.yaml

# Step 2: Interim to Processed
python preprocessing/diy_2_interim_to_processed.py --config config/preprocessing/diy.yaml
```

#### Option B: H3-based Location Clustering
```bash
# Step 1: Raw to Interim (H3)
python preprocessing/diy_h3_1_raw_to_interim.py --config config/preprocessing/diy_h3.yaml

# Step 2: Interim to Processed (H3)
python preprocessing/diy_h3_2_interim_to_processed.py --config config/preprocessing/diy_h3.yaml
```

---

## ğŸ“Š Expected Output Structure

```
data/
â”œâ”€â”€ raw_diy/
â”‚   â”œâ”€â”€ 3_staypoints_fun_generate_trips.csv
â”‚   â””â”€â”€ 10_filter_after_user_quality_DIY_slide_filteres.csv
â”‚
â”œâ”€â”€ diy_eps50/                                    # DBSCAN version (epsilon=50m)
â”‚   â”œâ”€â”€ interim/
â”‚   â”‚   â”œâ”€â”€ intermediate_eps50.csv
â”‚   â”‚   â”œâ”€â”€ locations_eps50.csv
â”‚   â”‚   â”œâ”€â”€ staypoints_merged_eps50.csv
â”‚   â”‚   â”œâ”€â”€ valid_users_eps50.csv
â”‚   â”‚   â””â”€â”€ interim_stats_eps50.json
â”‚   â”‚
â”‚   â””â”€â”€ processed/
â”‚       â”œâ”€â”€ diy_eps50_prev7_train.pk
â”‚       â”œâ”€â”€ diy_eps50_prev7_validation.pk
â”‚       â”œâ”€â”€ diy_eps50_prev7_test.pk
â”‚       â””â”€â”€ diy_eps50_prev7_metadata.json
â”‚
â””â”€â”€ diy_h3r8/                                     # H3 version (resolution=8)
    â”œâ”€â”€ interim/
    â”‚   â”œâ”€â”€ intermediate_h3r8.csv
    â”‚   â”œâ”€â”€ locations_h3r8.csv
    â”‚   â”œâ”€â”€ staypoints_merged_h3r8.csv
    â”‚   â”œâ”€â”€ valid_users_h3r8.csv
    â”‚   â””â”€â”€ interim_stats_h3r8.json
    â”‚
    â””â”€â”€ processed/
        â”œâ”€â”€ diy_h3r8_prev7_train.pk
        â”œâ”€â”€ diy_h3r8_prev7_validation.pk
        â”œâ”€â”€ diy_h3r8_prev7_test.pk
        â””â”€â”€ diy_h3r8_prev7_metadata.json
```

---

## ğŸ“ Citation

If you use this preprocessing pipeline in your research, please cite the relevant papers and this documentation.

---

## ğŸ“ Support

For questions or issues, please refer to the detailed documentation in each file or open an issue in the repository.
