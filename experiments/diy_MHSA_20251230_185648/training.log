Training MHSA model
Dataset: diy
Config: /data/next_loc_clean_v2/config/ht_grid_search/optuna_MHSA_diy_prev3_emb64_h2_l4_ff512_lr0.0005_t0.yaml
Device: cuda
Seed: 42
==================================================
Data loaders: train=599, val=60, test=69
Total trainable parameters: 1350750

=== Epoch 1 ===
Epoch 1, 1.7%	 loss: 8.915 acc@1: 0.00 mrr: 0.09, ndcg: 0.04, took: 1.01s
Epoch 1, 3.3%	 loss: 8.908 acc@1: 0.00 mrr: 0.09, ndcg: 0.03, took: 0.48s
Epoch 1, 5.0%	 loss: 8.909 acc@1: 0.00 mrr: 0.07, ndcg: 0.00, took: 0.47s
Epoch 1, 6.7%	 loss: 8.919 acc@1: 0.00 mrr: 0.07, ndcg: 0.00, took: 0.48s
Epoch 1, 8.3%	 loss: 8.909 acc@1: 0.00 mrr: 0.08, ndcg: 0.01, took: 0.49s
Epoch 1, 10.0%	 loss: 8.908 acc@1: 0.00 mrr: 0.10, ndcg: 0.04, took: 0.49s
Epoch 1, 11.7%	 loss: 8.907 acc@1: 0.00 mrr: 0.09, ndcg: 0.01, took: 0.47s
Epoch 1, 13.4%	 loss: 8.911 acc@1: 0.00 mrr: 0.09, ndcg: 0.03, took: 0.46s
Epoch 1, 15.0%	 loss: 8.909 acc@1: 0.04 mrr: 0.16, ndcg: 0.09, took: 0.47s
Epoch 1, 16.7%	 loss: 8.903 acc@1: 0.00 mrr: 0.14, ndcg: 0.05, took: 0.48s
Epoch 1, 18.4%	 loss: 8.902 acc@1: 0.00 mrr: 0.16, ndcg: 0.11, took: 0.47s
Epoch 1, 20.0%	 loss: 8.900 acc@1: 0.00 mrr: 0.15, ndcg: 0.10, took: 0.49s
Epoch 1, 21.7%	 loss: 8.905 acc@1: 0.00 mrr: 0.12, ndcg: 0.06, took: 0.46s
Epoch 1, 23.4%	 loss: 8.902 acc@1: 0.08 mrr: 0.19, ndcg: 0.11, took: 0.47s
Epoch 1, 25.0%	 loss: 8.900 acc@1: 0.00 mrr: 0.14, ndcg: 0.03, took: 0.46s
Epoch 1, 26.7%	 loss: 8.901 acc@1: 0.08 mrr: 0.25, ndcg: 0.17, took: 0.46s
Epoch 1, 28.4%	 loss: 8.895 acc@1: 0.00 mrr: 0.18, ndcg: 0.08, took: 0.46s
Epoch 1, 30.1%	 loss: 8.895 acc@1: 0.00 mrr: 0.23, ndcg: 0.15, took: 0.46s
Epoch 1, 31.7%	 loss: 8.895 acc@1: 0.04 mrr: 0.22, ndcg: 0.14, took: 0.46s
Epoch 1, 33.4%	 loss: 8.888 acc@1: 0.16 mrr: 0.40, ndcg: 0.30, took: 0.46s
Epoch 1, 35.1%	 loss: 8.885 acc@1: 0.08 mrr: 0.42, ndcg: 0.34, took: 0.46s
Epoch 1, 36.7%	 loss: 8.885 acc@1: 0.23 mrr: 0.71, ndcg: 0.76, took: 0.46s
Epoch 1, 38.4%	 loss: 8.876 acc@1: 0.51 mrr: 1.32, ndcg: 1.45, took: 0.47s
Epoch 1, 40.1%	 loss: 8.870 acc@1: 1.72 mrr: 2.60, ndcg: 2.74, took: 0.47s
Epoch 1, 41.7%	 loss: 8.857 acc@1: 3.40 mrr: 4.61, ndcg: 4.90, took: 0.48s
Epoch 1, 43.4%	 loss: 8.853 acc@1: 6.09 mrr: 6.94, ndcg: 7.08, took: 0.46s
Epoch 1, 45.1%	 loss: 8.833 acc@1: 8.71 mrr: 9.43, ndcg: 9.54, took: 0.46s
Epoch 1, 46.7%	 loss: 8.805 acc@1: 10.70 mrr: 11.43, ndcg: 11.51, took: 0.46s
Epoch 1, 48.4%	 loss: 8.765 acc@1: 12.23 mrr: 12.64, ndcg: 12.68, took: 0.47s
Epoch 1, 50.1%	 loss: 8.728 acc@1: 14.14 mrr: 14.57, ndcg: 14.65, took: 0.46s
Epoch 1, 51.8%	 loss: 8.674 acc@1: 14.06 mrr: 14.33, ndcg: 14.25, took: 0.46s
Epoch 1, 53.4%	 loss: 8.644 acc@1: 17.66 mrr: 17.97, ndcg: 17.96, took: 0.48s
Epoch 1, 55.1%	 loss: 8.622 acc@1: 14.30 mrr: 14.60, ndcg: 14.59, took: 0.46s
Epoch 1, 56.8%	 loss: 8.565 acc@1: 12.81 mrr: 13.18, ndcg: 13.16, took: 0.46s
Epoch 1, 58.4%	 loss: 8.523 acc@1: 16.88 mrr: 17.29, ndcg: 17.27, took: 0.45s
Epoch 1, 60.1%	 loss: 8.471 acc@1: 16.91 mrr: 17.39, ndcg: 17.44, took: 0.46s
Epoch 1, 61.8%	 loss: 8.416 acc@1: 17.89 mrr: 18.37, ndcg: 18.32, took: 0.45s
Epoch 1, 63.4%	 loss: 8.386 acc@1: 19.10 mrr: 19.64, ndcg: 19.68, took: 0.45s
Epoch 1, 65.1%	 loss: 8.354 acc@1: 17.73 mrr: 18.45, ndcg: 18.42, took: 0.46s
Epoch 1, 66.8%	 loss: 8.326 acc@1: 19.80 mrr: 20.72, ndcg: 20.82, took: 0.45s
Epoch 1, 68.4%	 loss: 8.196 acc@1: 21.41 mrr: 22.31, ndcg: 22.42, took: 0.46s
Epoch 1, 70.1%	 loss: 8.209 acc@1: 20.12 mrr: 21.11, ndcg: 21.26, took: 0.46s
Epoch 1, 71.8%	 loss: 8.019 acc@1: 23.52 mrr: 24.61, ndcg: 24.83, took: 0.46s
Epoch 1, 73.5%	 loss: 8.089 acc@1: 20.98 mrr: 22.03, ndcg: 22.16, took: 0.46s
Epoch 1, 75.1%	 loss: 8.014 acc@1: 22.11 mrr: 23.59, ndcg: 23.91, took: 0.46s
Epoch 1, 76.8%	 loss: 7.940 acc@1: 22.73 mrr: 24.32, ndcg: 24.79, took: 0.46s
Epoch 1, 78.5%	 loss: 7.898 acc@1: 22.66 mrr: 24.28, ndcg: 24.62, took: 0.46s
Epoch 1, 80.1%	 loss: 7.822 acc@1: 23.67 mrr: 25.03, ndcg: 25.29, took: 0.46s
Epoch 1, 81.8%	 loss: 7.733 acc@1: 24.49 mrr: 26.01, ndcg: 26.42, took: 0.47s
Epoch 1, 83.5%	 loss: 7.748 acc@1: 23.59 mrr: 24.97, ndcg: 25.15, took: 0.47s
Epoch 1, 85.1%	 loss: 7.575 acc@1: 23.59 mrr: 25.24, ndcg: 25.71, took: 0.47s
Epoch 1, 86.8%	 loss: 7.587 acc@1: 23.98 mrr: 25.73, ndcg: 26.14, took: 0.46s
Epoch 1, 88.5%	 loss: 7.470 acc@1: 24.92 mrr: 26.42, ndcg: 26.61, took: 0.47s
Epoch 1, 90.2%	 loss: 7.367 acc@1: 26.21 mrr: 27.82, ndcg: 28.08, took: 0.47s
Epoch 1, 91.8%	 loss: 7.272 acc@1: 26.17 mrr: 27.68, ndcg: 27.84, took: 0.47s
Epoch 1, 93.5%	 loss: 7.257 acc@1: 25.86 mrr: 27.34, ndcg: 27.61, took: 0.48s
Epoch 1, 95.2%	 loss: 7.255 acc@1: 25.51 mrr: 27.11, ndcg: 27.31, took: 0.46s
Epoch 1, 96.8%	 loss: 7.061 acc@1: 27.23 mrr: 28.81, ndcg: 29.05, took: 0.48s
Epoch 1, 98.5%	 loss: 7.143 acc@1: 25.98 mrr: 27.31, ndcg: 27.31, took: 0.46s
Validation - loss: 6.8820, acc@1: 27.13%, f1: 17.25%, mrr: 28.82%, ndcg: 29.03%
Current learning rate: 0.000250

=== Epoch 2 ===
Epoch 2, 1.7%	 loss: 7.037 acc@1: 26.29 mrr: 27.75, ndcg: 27.77, took: 0.47s
Epoch 2, 3.3%	 loss: 6.905 acc@1: 26.52 mrr: 28.25, ndcg: 28.39, took: 0.46s
Epoch 2, 5.0%	 loss: 6.990 acc@1: 25.12 mrr: 26.77, ndcg: 26.93, took: 0.46s
Epoch 2, 6.7%	 loss: 6.872 acc@1: 26.05 mrr: 27.66, ndcg: 27.80, took: 0.45s
Epoch 2, 8.3%	 loss: 6.737 acc@1: 27.58 mrr: 29.24, ndcg: 29.39, took: 0.45s
Epoch 2, 10.0%	 loss: 6.801 acc@1: 26.29 mrr: 28.17, ndcg: 28.40, took: 0.45s
Epoch 2, 11.7%	 loss: 6.696 acc@1: 28.09 mrr: 29.75, ndcg: 29.88, took: 0.47s
Epoch 2, 13.4%	 loss: 6.744 acc@1: 25.98 mrr: 27.84, ndcg: 28.06, took: 0.48s
Epoch 2, 15.0%	 loss: 6.547 acc@1: 27.46 mrr: 29.26, ndcg: 29.49, took: 0.47s
Epoch 2, 16.7%	 loss: 6.545 acc@1: 27.34 mrr: 29.22, ndcg: 29.37, took: 0.47s
Epoch 2, 18.4%	 loss: 6.519 acc@1: 27.73 mrr: 29.45, ndcg: 29.73, took: 0.48s
Epoch 2, 20.0%	 loss: 6.583 acc@1: 27.27 mrr: 28.97, ndcg: 29.11, took: 0.47s
Epoch 2, 21.7%	 loss: 6.528 acc@1: 27.54 mrr: 29.61, ndcg: 30.03, took: 0.46s
Epoch 2, 23.4%	 loss: 6.399 acc@1: 28.91 mrr: 30.76, ndcg: 31.10, took: 0.47s
Epoch 2, 25.0%	 loss: 6.314 acc@1: 29.88 mrr: 31.70, ndcg: 31.84, took: 0.46s
Epoch 2, 26.7%	 loss: 6.434 acc@1: 27.58 mrr: 29.48, ndcg: 29.79, took: 0.46s
Epoch 2, 28.4%	 loss: 6.324 acc@1: 28.52 mrr: 30.49, ndcg: 30.85, took: 0.46s
Epoch 2, 30.1%	 loss: 6.374 acc@1: 27.66 mrr: 29.75, ndcg: 30.19, took: 0.46s
Epoch 2, 31.7%	 loss: 6.284 acc@1: 27.81 mrr: 29.96, ndcg: 30.35, took: 0.46s
Epoch 2, 33.4%	 loss: 6.262 acc@1: 29.14 mrr: 31.21, ndcg: 31.59, took: 0.46s
Epoch 2, 35.1%	 loss: 6.268 acc@1: 28.95 mrr: 31.19, ndcg: 31.62, took: 0.46s
Epoch 2, 36.7%	 loss: 6.223 acc@1: 28.40 mrr: 30.57, ndcg: 30.93, took: 0.45s
Epoch 2, 38.4%	 loss: 6.204 acc@1: 28.79 mrr: 30.70, ndcg: 30.89, took: 0.45s
Epoch 2, 40.1%	 loss: 6.241 acc@1: 27.70 mrr: 29.84, ndcg: 30.18, took: 0.46s
Epoch 2, 41.7%	 loss: 6.317 acc@1: 27.15 mrr: 29.44, ndcg: 29.75, took: 0.46s
Epoch 2, 43.4%	 loss: 6.186 acc@1: 27.34 mrr: 29.77, ndcg: 30.15, took: 0.46s
Epoch 2, 45.1%	 loss: 6.094 acc@1: 28.24 mrr: 30.75, ndcg: 31.05, took: 0.49s
Epoch 2, 46.7%	 loss: 6.140 acc@1: 28.32 mrr: 30.73, ndcg: 31.16, took: 0.49s
Epoch 2, 48.4%	 loss: 6.106 acc@1: 28.32 mrr: 30.70, ndcg: 31.04, took: 0.50s
Epoch 2, 50.1%	 loss: 5.994 acc@1: 28.67 mrr: 31.22, ndcg: 31.74, took: 0.49s
Epoch 2, 51.8%	 loss: 6.150 acc@1: 28.36 mrr: 30.50, ndcg: 30.73, took: 0.49s
Epoch 2, 53.4%	 loss: 6.092 acc@1: 27.89 mrr: 30.17, ndcg: 30.43, took: 0.47s
Epoch 2, 55.1%	 loss: 6.098 acc@1: 27.50 mrr: 29.90, ndcg: 30.26, took: 0.47s
Epoch 2, 56.8%	 loss: 5.954 acc@1: 28.79 mrr: 31.18, ndcg: 31.51, took: 0.47s
Epoch 2, 58.4%	 loss: 5.932 acc@1: 29.34 mrr: 31.86, ndcg: 32.23, took: 0.50s
Epoch 2, 60.1%	 loss: 5.926 acc@1: 28.55 mrr: 31.09, ndcg: 31.49, took: 0.47s
Epoch 2, 61.8%	 loss: 5.968 acc@1: 28.05 mrr: 30.57, ndcg: 31.02, took: 0.47s
Epoch 2, 63.4%	 loss: 6.067 acc@1: 27.03 mrr: 29.81, ndcg: 30.34, took: 0.47s
Epoch 2, 65.1%	 loss: 5.883 acc@1: 28.28 mrr: 30.82, ndcg: 31.37, took: 0.47s
Epoch 2, 66.8%	 loss: 5.861 acc@1: 28.87 mrr: 31.54, ndcg: 32.13, took: 0.47s
Epoch 2, 68.4%	 loss: 5.745 acc@1: 30.27 mrr: 32.85, ndcg: 33.34, took: 0.46s
Epoch 2, 70.1%	 loss: 5.707 acc@1: 30.66 mrr: 33.31, ndcg: 33.91, took: 0.47s
Epoch 2, 71.8%	 loss: 5.862 acc@1: 27.54 mrr: 30.41, ndcg: 31.14, took: 0.47s
Epoch 2, 73.5%	 loss: 5.862 acc@1: 28.09 mrr: 30.69, ndcg: 31.18, took: 0.46s
Epoch 2, 75.1%	 loss: 5.743 acc@1: 29.38 mrr: 31.93, ndcg: 32.44, took: 0.46s
Epoch 2, 76.8%	 loss: 5.747 acc@1: 28.87 mrr: 31.52, ndcg: 32.07, took: 0.47s
Epoch 2, 78.5%	 loss: 5.721 acc@1: 29.18 mrr: 31.91, ndcg: 32.69, took: 0.46s
Epoch 2, 80.1%	 loss: 5.754 acc@1: 27.23 mrr: 30.22, ndcg: 30.92, took: 0.46s
Epoch 2, 81.8%	 loss: 5.664 acc@1: 29.80 mrr: 32.90, ndcg: 33.75, took: 0.46s
Epoch 2, 83.5%	 loss: 5.520 acc@1: 30.59 mrr: 33.47, ndcg: 34.30, took: 0.46s
Epoch 2, 85.1%	 loss: 5.677 acc@1: 29.57 mrr: 32.66, ndcg: 33.59, took: 0.46s
Epoch 2, 86.8%	 loss: 5.616 acc@1: 30.23 mrr: 33.01, ndcg: 33.69, took: 0.48s
Epoch 2, 88.5%	 loss: 5.665 acc@1: 28.75 mrr: 32.09, ndcg: 32.95, took: 0.46s
Epoch 2, 90.2%	 loss: 5.797 acc@1: 27.58 mrr: 30.64, ndcg: 31.46, took: 0.47s
Epoch 2, 91.8%	 loss: 5.557 acc@1: 29.88 mrr: 33.02, ndcg: 33.76, took: 0.47s
Epoch 2, 93.5%	 loss: 5.746 acc@1: 27.46 mrr: 30.44, ndcg: 31.17, took: 0.48s
Epoch 2, 95.2%	 loss: 5.703 acc@1: 28.12 mrr: 31.42, ndcg: 32.08, took: 0.48s
Epoch 2, 96.8%	 loss: 5.673 acc@1: 27.81 mrr: 31.14, ndcg: 31.89, took: 0.47s
Epoch 2, 98.5%	 loss: 5.461 acc@1: 29.77 mrr: 33.00, ndcg: 33.61, took: 0.46s
Validation - loss: 5.6237, acc@1: 29.68%, f1: 16.52%, mrr: 32.72%, ndcg: 33.43%
Current learning rate: 0.000000

=== Test Results ===
Test Results:
  acc@1: 31.34%
  acc@5: 36.05%
  acc@10: 39.59%
  mrr: 34.13%
  ndcg: 34.83%
  f1: 17.76%

=== Training Complete ===
